<!doctype html>
<html>

    <head>
        <title></title>
        <script src="js/jquery.js"></script>
        <!--<script src="http://code.jquery.com/jquery-3.3.1.min.js"></script> --> 
    </head>

    <body>
        <h1>Shopping Cart</h1>

        <div>
            <ul>
                <li><a class="add-to-cart" href="#" data-name="Apple" data-price="1.22">Apple $1.22</a></li>
                <li><a class="add-to-cart" href="#" data-name="Banana" data-price="1.33">Banana $1.33</a></li>
                <li><a class="add-to-cart" href="#" data-name="Shoe" data-price="22.33">Shoe $22.33</a></li>
            </ul>
            <button id="clear-cart">Clear Cart</button>
        </div>

        <div>
            <ul id="show-cart">
                <!-- -->
            </ul>
            <div>Total Cart: $<span id="total-cart"></span></div>
        </div>


        <script>

            // JQUERY STUFF
            $(".add-to-cart").click(function(event){
                event.preventDefault();
                var name = $(this).attr("data-name");
                var price = Number($(this).attr("data-price"));

                addItemToCart(name, price, 1);
                displayCart();
            });

            $("#clear-cart").click(function(event){
                clearCart();
                displayCart();
            });

            function displayCart()
            {
                var cartArray = listCart();
                var output = "";
                for(var i in cartArray)
                {
                    output += "<li>"
                        + cartArray[i].name
                        + " <input class='item-count' type='number' data-name='"
                        + cartArray[i].name
                        + "' value='" + cartArray[i].count + "' >"
                        + " x " + cartArray[i].price
                        + " = " + cartArray[i].total
                        + " <button class='plus-item' data-name='"
                        + cartArray[i].name + "'>Add Item</button>"
                        + " <button class='subtract-item' data-name='"
                        + cartArray[i].name + "'>Subtract Item</button>"
                        + " <button class='delete-item' data-name='"
                        + cartArray[i].name + "'>Delete Item</button>"
                        + "</li>";
                }
                $("#show-cart").html(output);
                $("#total-cart").html(totalCost());
            }

            $("#show-cart").on("click", ".delete-item", function (event) {
                var name = $(this).attr("data-name");
                removeItemFromCartAll(name);
                displayCart();
            });
            $("#show-cart").on("click", ".subtract-item", function (event) {
                var name = $(this).attr("data-name");
                removeItemFromCart(name);
                displayCart();
            });
            $("#show-cart").on("click", ".plus-item", function (event) {
                var name = $(this).attr("data-name");
                addItemToCart(name, 0, 1);
                displayCart();
            });

            // Shopping Cart Functions
            var cart = [];
            var Item = function(name, price, count) 
            {
                this.name = name;
                this.price = price;
                this.count = count;
            };

            // addItemToCart(name, price, count)
            function addItemToCart(name, price, count) 
            {
                for (var i in cart) //verify same item isnt added
                {
                    if (cart[i].name === name) //if item is added increment count
                    {
                        cart[i].count += count;
                        saveCart();
                        return;
                    }
                }
                var item = new Item(name, price, count);
                cart.push(item);
                saveCart();
            }  

            // removeItemFromCart(name) - only removes one item
            function removeItemFromCart(name) 
            {
                for (var i in cart)
                {
                    if (cart[i].name === name)
                    {
                        cart[i].count --;
                        if (cart[i].count === 0)
                        {
                            removeItemFromCartAll(name);//splice - remove item from array
                        }
                        break;
                    }
                }
                saveCart();
            }

            // removeItemFromCartAll(name) - removes all item
            function removeItemFromCartAll(name)
            {
                for (var i in cart)
                {
                    if(cart[i].name === name)
                    {
                        cart.splice(i, 1);
                        break;
                    }
                }
                saveCart();
            }

            // clearCart() - clear all of cart
            function clearCart() 
            {
                cart = [];
                saveCart();
            }

            // countCart() - return total count
            function countCart()
            {
                var totalCount = 0;
                for (var i in cart)
                {
                    totalCount += cart[i].count;
                }
                return totalCount;
            }

            // totalCart() - return total cost
            function totalCost()
            {
                var totalCost = 0;
                for (var i in cart)
                {
                    totalCost += cart[i].price * cart[i].count;
                }
                return totalCost.toFixed(2);
            }

            // listCart() - array of items
            function listCart()
            {
                var cartCopy = [];
                for (var i in cart)
                {
                    var item = cart[i];
                    var itemCopy = {};
                    for (var p in item) 
                    {
                        itemCopy[p] = item[p];
                    }
                    itemCopy.total = (item.price * item.count).toFixed(2);
                    cartCopy.push(itemCopy);
                }
                return cartCopy;
            }

            // saveCart() - allows to go from page to page - add an item and display cart later
            function saveCart() //use when edit is made to cart
            {
                localStorage.setItem("shoppingCart", JSON.stringify(cart)); //"name", value - convert to string or number
            }

            // loadCart() - load saved cart from local storage
            function loadCart()
            {
                cart = JSON.parse(localStorage.getItem("shoppingCart")); //this item will be a string - need to convert
            }

            loadCart();
            displayCart();

        </script>

    </body>

</html>